<% 
    users.sort((first, second) => {
        if (first.scans.length > second.scans.length) return -1
        else if (first.scans.length < second.scans.length) return 1
        else return 0
    })
    const TYPE_CUP_OF_ICE_CREAM = 1
    const TYPE_EXTRA_CREAM = 2
    const TYPE_EXTRA_SCOOP = 3
    const TYPE_SURPRISE = 4

    let types = [0, 0, 0, 0]
    let total = 0

    users.forEach(user => {
        switch (user.rewardType) {
            case TYPE_CUP_OF_ICE_CREAM:
                types[0]++
                total++
                break;
            case TYPE_EXTRA_CREAM:
                types[1]++
                total++
                break;
            case TYPE_EXTRA_SCOOP:
                types[2]++
                total++
                break;
            case TYPE_SURPRISE:
                types[3]++
                total++
                break;
        }    
    })
    
%> 

<div class="col">
    <div class="progress mb-2">
        <div title="Becher Eis + Löffel" class="progress-bar type-0" style="width: <%= types[0]/total*100 %>%;"><span style="padding-top: 2px;"><%= Math.round(types[0]/total*100) %>%</span></div>
        <div title="Portion Sahne" class="progress-bar type-1" style="width: <%= types[1]/total*100 %>%;"><span style="padding-top: 2px;"><%= Math.round(types[1]/total*100) %>%</span></div>
        <div title="Extra Kugel Eis" class="progress-bar type-2" style="width: <%= types[2]/total*100 %>%;"><span style="padding-top: 2px;"><%= Math.round(types[2]/total*100) %>%</span></div>
        <div title="Unbekannt (default)" class="progress-bar type-3" style="width: <%= types[3]/total*100 %>%;"><span style="padding-top: 2px;"><%= Math.round(types[3]/total*100) %>%</span></div>
    </div>

    <div style="display: flex; justify-content: space-around;" class="mb-2">
        <div style="display: flex;">
            <div class="rounded progress-bar type-0 mr-1" style="width: 1rem; height: 1rem; margin-top: 2px;"></div>
            <span style="font-size: small; margin-top: 2px;">Becher Eis + Löffel: <%= +(types[0]/total*100).toFixed(2) %>%</span>
        </div>
        <div style="display: flex;">
            <div class="rounded progress-bar type-1 mr-1" style="width: 1rem; height: 1rem; margin-top: 2px;"></div>
            <span style="font-size: small; margin-top: 2px;">Portion Sahne: <%= +(types[1]/total*100).toFixed(2) %>%</span>
        </div>
        <div style="display: flex;">
            <div class="rounded progress-bar type-2 mr-1" style="width: 1rem; height: 1rem; margin-top: 2px;"></div>
            <span style="font-size: small; margin-top: 2px;">Extra Kugel Eis: <%= +(types[2]/total*100).toFixed(2) %>%</span>
        </div>
        <div style="display: flex;">
            <div class="rounded progress-bar type-3 mr-1" style="width: 1rem; height: 1rem; margin-top: 2px;"></div>
            <span style="font-size: small; margin-top: 2px;">Unbekannt (default): <%= +(types[3]/total*100).toFixed(2) %>%</span>
        </div>
    </div>
    

    <% users.forEach(user => { %> 
        <div class="input-group mb-1">
            <div class="input-group-prepend fixed-width">
                <div class="input-group-text fixed-width"><%= user.username %> </div>
            </div>
            <div class="form-control text-right username">
                <%= user.scans.length %>
            </div>
            <div class="input-group-append">
                <a class="btn btn-custom border" target="_blank" onclick="getUser('<%= user.username %>')">
                    <i class="fas fa-chevron-right"></i>
                </a>
            </div>
        </div>
    <% }) %> 
</div>